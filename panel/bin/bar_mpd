#! /bin/sh

# Source colours and icons
. panel_config

# Set the icon when no music is playing
icoMUSIQUE="%{F$CYAN}%{B$BASE00} $icoMUSIC %{F-}%{B$BASE01}"

while :; do
    sleep 0.5
    # Is mopidy running?
    if  pidof -x mopidy && mpc status; then
        cur=`mpc current`

        # test -n "$cur" && echo c$cur | skroll -n 40 -d 0.2 -r || echo "- stopped -"

        # Check if a song is [playing, paused, else]
        # and set the corrent icon, color and message
        if mpc status | grep -oe playing ; then
            echo "c%{F$GREEN}%{B$BASE00} $icoPLAY %{F-}%{B$BASE01} $cur"
        elif mpc status | grep -oe paused ; then
            echo "c%{F$CYAN}%{B$CBASE00} $icoPAUSE %{F-}%{B$BASE01} $cur"
        else
            echo "c$icoMUSIQUE - stopped -"
        fi


    else
        echo "c$icoMUSIQUE - Mopidy not running - "
    fi
done
